---
- name: Reload IOS Device
  hosts: ios
  connection: network_cli
  gather_facts: no
  vars:
    connect_timeout: 50
    command_timeout: 50
  vars_files:
    - default_vars.yml

  tasks:

    - name: Gather IOS facts before reload
      ios_facts:

    - name: Reload router
      cli_command:
        command: reload
        prompt:
          - confirm
        answer:
          - y

    # - name: Wait for router to come back up
    #   wait_for:
    #     port: 22
    #     state: started
    #     timeout: 300
    #     delay: 60
    #     host: "{{ inventory_hostname }}"

    - name: Wait for router to come back up
      wait_for_connection:
        connect_timeout: 30
        sleep: 10
        timeout: 300
        delay: 60

    - name: Gather IOS facts after reload
      ios_facts:

    - name: Print installed OS
      debug:
        var: ansible_net_version
