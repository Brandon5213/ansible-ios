---
- name: build IOS XE inventory
  hosts: ios
  connection: network_cli
  gather_facts:  False

  vars:
    desired_ios_version: "16.08.01b"

  tasks:

  - name: Gather IOS facts
    ios_facts:
      gather_subset: all
    register: all_facts

      # - name: Show all all facts
      #   debug:
      #     var: all_facts

  - name: create HTML report
    template:
      src: ./templates/ios/report-ios.j2
      dest: /tmp/inventory_report_ios.html
    delegate_to: localhost
    run_once: true

- name: Copy inventory document to webserver
  hosts: webserver
  become: yes

  tasks:

  - name: copy file to webserver
    copy:
      src: /tmp/inventory_report_ios.html
      dest: /var/www/html/report_ios.html
    notify:
      - restart_apache

  handlers:
    - name: restart_apache
      service:
        name: httpd
        state: restarted

- name: Delete local copy of inventory
  hosts: localhost

  tasks:
  - name: Delete local copy of inventory inventory
    file:
      name: /tmp/inventory_report_ios.html
      state: absent
